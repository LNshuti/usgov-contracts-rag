2024-12-04 20:53:27,977 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for data files: {'db.db'} (connection.py:367)
2024-12-04 20:53:28,258 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for in-memory database (connection.py:369)
2024-12-04 20:53:28,272 - MainThread - sqlmesh.core.config.connection - INFO - Using existing DuckDB adapter due to overlapping data file: db.db (connection.py:363)
2024-12-04 20:53:32,210 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema db.sqlmesh__sqlmesh_example (evaluator.py:303)
2024-12-04 20:53:32,210 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT CURRENT_CATALOG() (base.py:2062)
2024-12-04 20:53:32,212 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT CURRENT_CATALOG() (base.py:2062)
2024-12-04 20:53:32,215 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM information_schema.tables WHERE (table_catalog = 'db' AND table_schema = 'sqlmesh__sqlmesh_example') AND table_name IN ('sqlmesh_example__full_model__4172354105', 'sqlmesh_example__seed_model__642023120', 'sqlmesh_example__incremental_model__1490709219') (base.py:2062)
2024-12-04 20:53:32,246 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'db.sqlmesh__sqlmesh_example' (evaluator.py:962)
2024-12-04 20:53:32,246 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE SCHEMA IF NOT EXISTS "db"."sqlmesh__sqlmesh_example" (base.py:2062)
2024-12-04 20:53:32,247 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table 'db.sqlmesh__sqlmesh_example.sqlmesh_example__seed_model__642023120' (evaluator.py:1261)
2024-12-04 20:53:32,248 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE TABLE IF NOT EXISTS "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__seed_model__642023120" ("id" INT, "item_id" INT, "event_date" DATE) (base.py:2062)
2024-12-04 20:53:32,254 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE OR REPLACE TABLE "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__seed_model__642023120" AS SELECT CAST("id" AS INT) AS "id", CAST("item_id" AS INT) AS "item_id", CAST("event_date" AS DATE) AS "event_date" FROM (SELECT "id", "item_id", "event_date" FROM "db"."sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__seed_model__642023120_kr1moje9") AS "_subquery" (base.py:2062)
2024-12-04 20:53:32,255 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: DROP TABLE IF EXISTS "db"."sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__seed_model__642023120_kr1moje9" (base.py:2062)
2024-12-04 20:53:32,260 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table 'db.sqlmesh__sqlmesh_example.sqlmesh_example__incremental_model__1490709219' (evaluator.py:1261)
2024-12-04 20:53:32,260 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE TABLE IF NOT EXISTS "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__1490709219" ("id" INT, "item_id" INT, "event_date" DATE) (base.py:2062)
2024-12-04 20:53:32,261 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Dry running model 'sqlmesh_example.incremental_model' (evaluator.py:1283)
2024-12-04 20:53:32,261 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT "seed_model"."id" AS "id", "seed_model"."item_id" AS "item_id", "seed_model"."event_date" AS "event_date" FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__seed_model__642023120" AS "seed_model" WHERE ("seed_model"."event_date" <= CAST('1970-01-01' AS DATE) AND "seed_model"."event_date" >= CAST('1970-01-01' AS DATE)) AND FALSE LIMIT 0 (base.py:2062)
2024-12-04 20:53:32,264 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table 'db.sqlmesh__sqlmesh_example.sqlmesh_example__full_model__4172354105' (evaluator.py:1261)
2024-12-04 20:53:32,265 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE TABLE IF NOT EXISTS "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__full_model__4172354105" ("item_id" INT, "num_orders" BIGINT) (base.py:2062)
2024-12-04 20:53:32,265 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Dry running model 'sqlmesh_example.full_model' (evaluator.py:1283)
2024-12-04 20:53:32,265 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT "incremental_model"."item_id" AS "item_id", COUNT(DISTINCT "incremental_model"."id") AS "num_orders" FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__1490709219" AS "incremental_model" WHERE FALSE GROUP BY "incremental_model"."item_id" LIMIT 0 (base.py:2062)
2024-12-04 20:53:32,301 - MainThread - sqlmesh.core.state_sync.engine_adapter - INFO - Adding interval (1733270400000, 1733356800000) for snapshot SnapshotId<"db"."sqlmesh_example"."seed_model": 3127385035> (engine_adapter.py:935)
2024-12-04 20:53:32,305 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"db"."sqlmesh_example"."incremental_model": 4030212347> (evaluator.py:545)
2024-12-04 20:53:32,308 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (1577836800000, 1733356800000) into db.sqlmesh__sqlmesh_example.sqlmesh_example__incremental_model__1490709219' (evaluator.py:576)
2024-12-04 20:53:32,309 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: DELETE FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__1490709219" WHERE "event_date" BETWEEN CAST('2020-01-01' AS DATE) AND CAST('2024-12-04' AS DATE) (base.py:2062)
2024-12-04 20:53:32,310 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: INSERT INTO "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__1490709219" ("id", "item_id", "event_date") SELECT "id", "item_id", "event_date" FROM (SELECT "seed_model"."id" AS "id", "seed_model"."item_id" AS "item_id", "seed_model"."event_date" AS "event_date" FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__seed_model__642023120" AS "seed_model" WHERE "seed_model"."event_date" <= CAST('2024-12-04' AS DATE) AND "seed_model"."event_date" >= CAST('2020-01-01' AS DATE)) AS "_subquery" WHERE "event_date" BETWEEN CAST('2020-01-01' AS DATE) AND CAST('2024-12-04' AS DATE) (base.py:2062)
2024-12-04 20:53:32,310 - MainThread - sqlmesh.core.state_sync.engine_adapter - INFO - Adding interval (1577836800000, 1733356800000) for snapshot SnapshotId<"db"."sqlmesh_example"."incremental_model": 4030212347> (engine_adapter.py:935)
2024-12-04 20:53:32,314 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"db"."sqlmesh_example"."full_model": 2779642228> (evaluator.py:545)
2024-12-04 20:53:32,315 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (1733270400000, 1733356800000) into db.sqlmesh__sqlmesh_example.sqlmesh_example__full_model__4172354105' (evaluator.py:576)
2024-12-04 20:53:32,316 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE OR REPLACE TABLE "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__full_model__4172354105" AS SELECT CAST("item_id" AS INT) AS "item_id", CAST("num_orders" AS BIGINT) AS "num_orders" FROM (SELECT "incremental_model"."item_id" AS "item_id", COUNT(DISTINCT "incremental_model"."id") AS "num_orders" FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__1490709219" AS "incremental_model" GROUP BY "incremental_model"."item_id") AS "_subquery" (base.py:2062)
2024-12-04 20:53:32,317 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Auditing snapshot SnapshotId<"db"."sqlmesh_example"."full_model": 2779642228> (evaluator.py:462)
2024-12-04 20:53:32,317 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: DESCRIBE "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__full_model__4172354105" (base.py:2062)
2024-12-04 20:53:32,319 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT COUNT(*) FROM (SELECT * FROM (SELECT * FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__full_model__4172354105" AS "sqlmesh_example__full_model__4172354105") AS "_q_0" WHERE "item_id" < 0) AS "audit" (base.py:2062)
2024-12-04 20:53:32,319 - MainThread - sqlmesh.core.state_sync.engine_adapter - INFO - Adding interval (1733270400000, 1733356800000) for snapshot SnapshotId<"db"."sqlmesh_example"."full_model": 2779642228> (engine_adapter.py:935)
2024-12-04 20:53:32,324 - MainThread - sqlmesh.core.state_sync.engine_adapter - INFO - Promoting environment 'prod' (engine_adapter.py:268)
2024-12-04 20:53:32,333 - MainThread - sqlmesh.core.state_sync.engine_adapter - INFO - Unpausing snapshot SnapshotId<"db"."sqlmesh_example"."seed_model": 3127385035> (engine_adapter.py:437)
2024-12-04 20:53:32,333 - MainThread - sqlmesh.core.state_sync.engine_adapter - INFO - Unpausing snapshot SnapshotId<"db"."sqlmesh_example"."full_model": 2779642228> (engine_adapter.py:437)
2024-12-04 20:53:32,334 - MainThread - sqlmesh.core.state_sync.engine_adapter - INFO - Unpausing snapshot SnapshotId<"db"."sqlmesh_example"."incremental_model": 4030212347> (engine_adapter.py:437)
2024-12-04 20:53:32,335 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'db.sqlmesh_example' (evaluator.py:962)
2024-12-04 20:53:32,335 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE SCHEMA IF NOT EXISTS "db"."sqlmesh_example" (base.py:2062)
2024-12-04 20:53:32,336 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'db.sqlmesh_example.seed_model' to point at table 'db.sqlmesh__sqlmesh_example.sqlmesh_example__seed_model__642023120' (evaluator.py:1227)
2024-12-04 20:53:32,336 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE OR REPLACE VIEW "db"."sqlmesh_example"."seed_model" AS SELECT * FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__seed_model__642023120" (base.py:2062)
2024-12-04 20:53:32,336 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'db.sqlmesh_example.incremental_model' to point at table 'db.sqlmesh__sqlmesh_example.sqlmesh_example__incremental_model__1490709219' (evaluator.py:1227)
2024-12-04 20:53:32,337 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE OR REPLACE VIEW "db"."sqlmesh_example"."incremental_model" AS SELECT * FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__1490709219" (base.py:2062)
2024-12-04 20:53:32,337 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'db.sqlmesh_example.full_model' to point at table 'db.sqlmesh__sqlmesh_example.sqlmesh_example__full_model__4172354105' (evaluator.py:1227)
2024-12-04 20:53:32,338 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE OR REPLACE VIEW "db"."sqlmesh_example"."full_model" AS SELECT * FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__full_model__4172354105" (base.py:2062)
2024-12-04 20:53:32,338 - MainThread - sqlmesh.core.state_sync.engine_adapter - INFO - Finalizing environment 'prod' (engine_adapter.py:389)
2024-12-04 20:53:32,348 - MainThread - root - INFO - Shutting down the event dispatcher (dispatcher.py:159)
